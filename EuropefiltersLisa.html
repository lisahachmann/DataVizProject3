<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Social Media Data Charts</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    </head>
<body>
    <h1>European country's views of each other</h1>
    <div>
        <svg id ="viz" height="500" width="800" style="border: 1px solid grey"></svg>

    </div>

    <div class="btn-group" role="group">
      <button type="button" class="btn btn-default country" id="Britain">Britain</button>
      <button type="button" class="btn btn-default country" id="France">France</button>
      <button type="button" class="btn btn-default country" id="Germany">Germany</button>
      <button type="button" class="btn btn-default country" id="Italy">Italy</button>
      <button type="button" class="btn btn-default country" id="Spain">Spain</button>
      <button type="button" class="btn btn-default country" id="Greece">Greece</button>
      <button type="button" class="btn btn-default country" id="Poland" >Poland</button>
      <button type="button" class="btn btn-default country" id="Czech Republic">Czech Republic</button>
    </div>

    <div class ="btn-group" role="group">
      <button type="button" class="btn btn-default observation" id="Trustworthiness">Trustworthiness</button>
      <button type="button" class="btn btn-default observation" id="Arrogant">
      Arrogant
      </button>
      <button type="button" class="btn btn-default observation" id="Compassionate">Compassionate</button>
    </div>


    </div>

<script type="text/javascript">

    var Gsvg = d3.select("#viz");
    var gheight = Gsvg.attr("height");
    var gwidth = Gsvg.attr("width");
    var gGroup = Gsvg.append("g");

    var GLOBAL = {data: [], country_button: null, observation_button: null, big_countries:["Britain", "France", "Germany", "Italy", "Spain", "Greece, Poland", "Czech Republic"]};

    function computeSizes (svg) {
    // get the size of the SVG element
    var height = svg.attr("height");
    var width = svg.attr("width");
    var margin = 10;
    // the chart lives in the svg surrounded by a margin of 100px
    return { height:height,
	    width: width,
	    margin: margin,
	    chartHeight: height-2*margin,
	    chartWidth: width-2*margin}
}

        window.addEventListener("load", run);

        function run () {

        d3.csv("EuropeanUnionfeelings.csv", function(data) {
        GLOBAL.data = data;
        });

        d3.selectAll("button.country").on("click", function(){
          GLOBAL.country_button = this.id;
          stateCheck();
          console.log("CLICKED COUNTRY");
        });

        d3.selectAll("button.observation").on("click", function(){
          GLOBAL.observation_button = this.id;
          stateCheck();
          console.log("CLICKED OBSERVATION");
        });
      }

function stateCheck(){
  if ((GLOBAL.country_button !== null) && (GLOBAL.observation_button !== null)){
    var countryob = countbyColumn(GLOBAL.country_button, GLOBAL.observation_button)
  }
    console.log(countryob);
  console.log("STATE CHECK");
}

function countbyColumn(country,observation){
    //var observation = 'Arrogance';
    console.log("COUNT BY COLUMN RUN");
    var counts = {};
    var all = 0;
    var bigresponses0 = {};
    var bigresponses1 = {};
     GLOBAL.data.forEach(function(r) {
         if (r["COUNTRY"] == country){
            if (r["COUNTRY"] in counts){
                all = all + 1;
                counts[r["COUNTRY"]] +=1;
                if(r[observation+"0"] in bigresponses0){
                    bigresponses0[r[observation+"0"]] +=1;
                }
                else {
                    bigresponses0[r[observation+"0"]] =1;
                }
                if(r[observation+"1"] in bigresponses1){
                    bigresponses1[r[observation+"1"]] +=1;
                }
                else{
                    bigresponses1[r[observation+"1"]] =1;
                }
            }
            else{
                counts[r["COUNTRY"]] = 1;
            }
        }
    })


return {bigresponses0, bigresponses1, all}
}

function draw(){
    console.log(GLOBAL.data);
    barPadding = gwidth/20;
    var g = gGroup.selectAll("rect")
    .data(GLOBAL.data)
    .enter()
    .append("g");

    g.append("rect") //Makes the columns for male percentages of all sites
    .attr("x", 15)
    .attr("y",45)
    .attr("width", 20)
    .attr("height", 20)
    .style("fill", "blue");


}
draw()
</script>
</body>
</html>
